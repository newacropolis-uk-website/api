language: python
python:
- '2.7'
cache: pip
services:
- postgresql
install:
- ./scripts/bootstrap.sh
- pip install coveralls
script:
- eval $INTEGRITY_SCRIPT
- ./scripts/run_tests.sh
after_success:
- coveralls
before_deploy:
- openssl aes-256-cbc -K $encrypted_6a339e7dd8d1_key -iv $encrypted_6a339e7dd8d1_iv 
  -in credentials.tar.gz.enc -out credentials.tar.gz -d
- eval "$(ssh-agent -s)"
- chmod 600 travis_rsa
- ssh-add travis_rsa
deploy:
  - provider: script
    skip_cleanup: true
    script: ./scripts/deploy.sh preview
    on:
      branch: master
  - provider: script
    skip_cleanup: true
    script: ./scripts/deploy.sh development
    on:
      branch: test-deploy
  - provider: script
    skip_cleanup: true
    script: ./scripts/deploy.sh live
    on:
      tags: true
